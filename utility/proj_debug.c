//*****************************************************************************
//
// proj_debug.c - project wide debug api
//
// Copyright (c) notice
//
//*****************************************************************************
#ifndef DEBUG

#else
#ifndef __PROJ_DEBUG_C__
#define __PROJ_DEBUG_C__
//*****************************************************************************
// includes
//*****************************************************************************
#include <stdint.h>
#include <stdbool.h>
#include <string.h>
#include <stdlib.h>

#include "utils_inc/error_codes.h"
#include "utils_inc/proj_debug.h"

/******************************************************************************
* defines /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
******************************************************************************/

#define SYS_HALT_MSG  "****!!!!SYS HALT!!!!****\r\n"
#define SYS_ASSERT_RST_MSG  "****!!!!SYS ASSERT RESET!!!!****\r\n"

/******************************************************************************
* variables ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
******************************************************************************/

/******************************************************************************
* external variables //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
******************************************************************************/

/******************************************************************************
* enums ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
******************************************************************************/

/******************************************************************************
* structures //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
******************************************************************************/

/******************************************************************************
* external functions //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
******************************************************************************/

/******************************************************************************
* private function declarations ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
******************************************************************************/

/******************************************************************************
* public functions ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
******************************************************************************/

//*****************************************************************************
// name: vDEBUG
// description: sends a message out the debug message interface
// param description: none
// return value description: none
//*****************************************************************************
void vDEBUG(char * cMsg, ...)
{
  ERROR_CODE eEC_Is_OS_Running = ER_FALSE;
  uint16_t uiLen = 0;
  uiLen = strlen(cMsg);

  eEC_Is_OS_Running = eOSAL_Is_OS_Running();

  if(eEC_Is_OS_Running == ER_FALSE)
  {

  }
  else
  {

  }
  return;
}

void vDEBUG_ASSERT(char * cMsg,int iAssert)
{
  ERROR_CODE eEC = ER_FAIL;

  if(iAssert)
  {
    return;
  }
  else
  {
    //todo detct debugger eEC = eBSP_debugger_detect();
    if(eEC == ER_OK)
    {
      vDEBUG(SYS_HALT_MSG);
      vDEBUG(cMsg);

      //todo: disable interrupts
      //todo: system halt
      while(1){};
    }
    else
    {
      vDEBUG(SYS_HALT_MSG);
      vDEBUG(cMsg);

      //todo: disable interrupts
      //todo: system reset
      while(1){};
    }
  }
}

/******************************************************************************
* name: vDEBUG_GPIO_SET_1
* description: sets high DEBUG_GPIO_PIN_1
* param description:
* return value description:
******************************************************************************/
void vDEBUG_GPIO_SET_1(void)
{
  //todo: set gpio pin
  return;
}

/******************************************************************************
* name: vDEBUG_GPIO_CLR_1
* description: sets low DEBUG_GPIO_PIN_1
* param description:
* return value description:
******************************************************************************/
void vDEBUG_GPIO_CLR_1(void)
{
  //todo: clear pin
  return;
}

/******************************************************************************
* name: vDEBUG_GPIO_TOGGLE_1
* description: toggles DEBUG_GPIO_PIN_1
* param description:
* return value description:
******************************************************************************/
void vDEBUG_GPIO_TOGGLE_1(void)
{
  //todo: toggle pin

  return;
}

/******************************************************************************
* name: vDEBUG_init
* description: initalizes the debug message interface and the debug gpio pins
* param description: none
* return value description: none
******************************************************************************/
void vDEBUG_init(void)
{
  ERROR_CODE eEC = ER_FAIL;

  //todo: init debug uart

  //todo detect debugger eEC = eBSP_debugger_detect();
  if(eEC == ER_OK)
  {
    vDEBUG("Debugger connected!");
  }
  else
  {
    vDEBUG("Debugger NOT connected!");
  }

  return;
}
#endif //__PROJ_DEBUG_C__
#endif //DEBUG
